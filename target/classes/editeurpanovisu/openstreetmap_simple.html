<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carte - Géolocalisation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, html {
            height: 100%;
            width: 100%;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #debug-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0,255,0,0.9);
            color: #000;
            padding: 8px;
            font-family: monospace;
            font-size: 11px;
            z-index: 99999;
            height: 40px;
        }
        
        #map-container {
            position: absolute;
            top: 40px;
            left: 0;
            right: 0;
            bottom: 50px;
            width: 100%;
        }
        
        #map-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        #controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 50px;
            background: #f0f0f0;
            border-top: 1px solid #ccc;
            padding: 10px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        #controls input {
            flex: 1;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        
        #controls button {
            padding: 5px 15px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        
        #controls button:hover {
            background: #005a9e;
        }
        
        #controls select {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div id="debug-panel">✅ Carte Simple - Prête | Lat: 48.8566, Lon: 2.3522 | Zoom: 13</div>
    
    <div id="map-container">
        <iframe id="map-frame" 
                src="https://www.openstreetmap.org/export/embed.html?bbox=2.2522%2C48.7566%2C2.4522%2C48.9566&layer=mapnik&marker=48.8566%2C2.3522"
                allowfullscreen>
        </iframe>
    </div>
    
    <div id="controls">
        <input type="number" id="lat-input" placeholder="Latitude" value="48.8566" step="0.0001">
        <input type="number" id="lon-input" placeholder="Longitude" value="2.3522" step="0.0001">
        <input type="number" id="zoom-input" placeholder="Zoom" value="13" min="1" max="19">
        <select id="map-type">
            <option value="mapnik">OpenStreetMap</option>
            <option value="cyclemap">CycleMap</option>
        </select>
        <button onclick="updateMap()">Mettre à jour</button>
        <button onclick="validerPosition()">Valider</button>
    </div>
    
    <script>
        let currentLat = 48.8566;
        let currentLon = 2.3522;
        let currentZoom = 13;
        let currentMapType = 'mapnik';
        
        function updateMap() {
            currentLat = parseFloat(document.getElementById('lat-input').value) || 48.8566;
            currentLon = parseFloat(document.getElementById('lon-input').value) || 2.3522;
            currentZoom = parseInt(document.getElementById('zoom-input').value) || 13;
            currentMapType = document.getElementById('map-type').value;
            
            // Calculer la bbox (zone d'affichage)
            const delta = 0.1 / currentZoom;
            const minLon = currentLon - delta;
            const maxLon = currentLon + delta;
            const minLat = currentLat - delta;
            const maxLat = currentLat + delta;
            
            // Construire l'URL
            const url = `https://www.openstreetmap.org/export/embed.html?` +
                       `bbox=${minLon}%2C${minLat}%2C${maxLon}%2C${maxLat}` +
                       `&layer=${currentMapType}` +
                       `&marker=${currentLat}%2C${currentLon}`;
            
            document.getElementById('map-frame').src = url;
            
            // Mettre à jour le debug
            document.getElementById('debug-panel').textContent = 
                `✅ Carte Simple - Mise à jour | Lat: ${currentLat}, Lon: ${currentLon} | Zoom: ${currentZoom}`;
            
            console.log('Carte mise à jour:', currentLat, currentLon, currentZoom);
        }
        
        function validerPosition() {
            console.log('Position validée:', currentLat, currentLon);
            alert('Position: ' + currentLat + ', ' + currentLon);
        }
        
        function getCoordonnees() {
            return currentLat + "," + currentLon;
        }
        
        function afficherCarte(lon, lat, zoom) {
            document.getElementById('lat-input').value = lat;
            document.getElementById('lon-input').value = lon;
            document.getElementById('zoom-input').value = zoom || 13;
            updateMap();
        }
        
        function placeMarker(lon, lat) {
            afficherCarte(lon, lat, currentZoom);
        }
        
        // Compatibilité avec l'ancien code
        function getNomsLayers() {
            return "*mapnik|cyclemap|";
        }
        
        function changeLayer(strLayer) {
            document.getElementById('map-type').value = strLayer;
            updateMap();
        }
        
        function initializeMap() {
            console.log('Carte simple initialisée');
            document.getElementById('debug-panel').textContent = 
                '✅ Carte Simple - Initialisée | Cliquez sur "Mettre à jour" pour changer la position';
        }
        
        // Auto-initialisation
        setTimeout(initializeMap, 100);
        
        console.log('✅ Carte simple chargée');
    </script>
</body>
</html>
